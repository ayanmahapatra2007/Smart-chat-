function botReply(message) {
  const chatBox = document.getElementById("chat-box");
  const para = document.createElement("div");
  para.className = "message bot-message";
  para.textContent = "ğŸ¤– " + message;
  chatBox.appendChild(para);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function userReply(message) {
  const chatBox = document.getElementById("chat-box");
  const para = document.createElement("div");
  para.className = "message user-message";
  para.textContent = "ğŸ§‘â€ğŸ’¬ " + message;
  chatBox.appendChild(para);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function autoScroll(container) {
  const threshold = 50;
  const scrollPosition = container.scrollTop + container.clientHeight;
  const scrollHeight = container.scrollHeight;
  if (scrollHeight - scrollPosition < threshold) {
    container.scrollTop = scrollHeight;
  }
}

function similarity(s1, s2) {
  // Basic similarity check: count matching characters ratio
  s1 = s1.replace(/\s+/g, '');
  s2 = s2.replace(/\s+/g, '');
  if (!s1.length || !s2.length) return 0;
  let matches = 0;
  const len = Math.min(s1.length, s2.length);
  for (let i = 0; i < len; i++) {
    if (s1[i] === s2[i]) matches++;
  }
  return matches / Math.max(s1.length, s2.length);
}

function sendMessage() {
  const input = document.getElementById("user-input");
  let userInputRaw = input.value.trim();
  let userInput = userInputRaw.toLowerCase();

  if (!userInputRaw) return; // empty input ignore

  userReply(userInputRaw);
  input.value = "";

  const replies = [
    { keywords: ["à¦¹à§à¦¯à¦¾à¦²à§‹", "hello", "hi", "à¦¨à¦®à¦¸à§à¦•à¦¾à¦°"], reply: "à¦¹à§à¦¯à¦¾à¦²à§‹! à¦•à§‡à¦®à¦¨ à¦†à¦›à§‹? ğŸ˜Š à¦ªà§à¦°à¦¶à§à¦¨ à¦•à¦°à§‹à¥¤" },
    { keywords: ["à¦¤à§à¦®à¦¿ à¦•à§‡à¦®à¦¨", "à¦•à§‡à¦®à¦¨ à¦†à¦›à§‹", "how are you"], reply: "à¦†à¦®à¦¿ à¦­à¦¾à¦²à§‹ à¦†à¦›à¦¿! à¦¤à§à¦®à¦¿ à¦•à§‡à¦®à¦¨ à¦†à¦›à§‹?" },
    { keywords: ["à¦¤à§‹à¦®à¦¾à¦° à¦¨à¦¾à¦®", "à¦¤à§à¦®à¦¿ à¦•à§‡"], reply: "à¦†à¦®à¦¾à¦° à¦¨à¦¾à¦® Smart Chat, à¦†à¦° à¦†à¦®à¦¾à¦•à§‡ à¦¤à§ˆà¦°à¦¿ à¦•à¦°à§‡à¦›à§‡ Ayan ğŸ’»" },
    { keywords: ["à¦¤à§‹à¦®à¦¾à¦•à§‡ à¦•à§‡ à¦¬à¦¾à¦¨à¦¿à¦¯à¦¼à§‡à¦›à§‡", "à¦¬à¦¾à¦¨à¦¿à§Ÿà§‡à¦›à§‡", "creator"], reply: "à¦†à¦®à¦¾à¦•à§‡ à¦¬à¦¾à¦¨à¦¿à¦¯à¦¼à§‡à¦›à§‡ Ayan Mahapatra â¤ï¸" },

    { keywords: ["à¦†à¦œà¦•à§‡ à¦•à¦¿ à¦¦à¦¿à¦¨", "à¦†à¦œ à¦•à¦¿", "ki din"], reply: "à¦†à¦œà¦•à§‡ à¦¹à¦²à§‹ " + new Date().toLocaleDateString('bn-BD', { weekday: 'long' }) },
    { keywords: ["à¦¸à¦®à§Ÿ", "à¦à¦–à¦¨ à¦•à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡", "time"], reply: "à¦à¦–à¦¨ à¦¸à¦®à§Ÿ: " + new Date().toLocaleTimeString('bn-BD') },

    { keywords: ["à¦­à¦¾à¦°à¦¤à§‡à¦° à¦ªà§à¦°à¦§à¦¾à¦¨à¦®à¦¨à§à¦¤à§à¦°à§€", "modi", "pm"], reply: "à¦­à¦¾à¦°à¦¤à§‡à¦° à¦ªà§à¦°à¦§à¦¾à¦¨à¦®à¦¨à§à¦¤à§à¦°à§€ à¦¹à¦²à§‡à¦¨ à¦¨à¦°à§‡à¦¨à§à¦¦à§à¦° à¦®à§‹à¦¦à¦¿ ğŸ‡®ğŸ‡³" },
    { keywords: ["à¦ªà¦¶à§à¦šà¦¿à¦®à¦¬à¦™à§à¦—à§‡à¦° à¦®à§à¦–à§à¦¯à¦®à¦¨à§à¦¤à§à¦°à§€"], reply: "à¦ªà¦¶à§à¦šà¦¿à¦®à¦¬à¦™à§à¦—à§‡à¦° à¦®à§à¦–à§à¦¯à¦®à¦¨à§à¦¤à§à¦°à§€ à¦¹à¦²à§‡à¦¨ à¦®à¦®à¦¤à¦¾ à¦¬à§à¦¯à¦¾à¦¨à¦¾à¦°à§à¦œà¦¿ ğŸ‘©â€âš–ï¸" },
    { keywords: ["à¦œà¦¾à¦¤à§€à¦¯à¦¼ à¦ªà¦¶à§"], reply: "à¦­à¦¾à¦°à¦¤à§‡à¦° à¦œà¦¾à¦¤à§€à¦¯à¦¼ à¦ªà¦¶à§ à¦¹à¦²à§‹ à¦°à¦¯à¦¼à§‡à¦² à¦¬à§‡à¦™à§à¦—à¦² à¦Ÿà¦¾à¦‡à¦—à¦¾à¦° ğŸ…" },
    { keywords: ["à¦œà¦¾à¦¤à§€à¦¯à¦¼ à¦«à§à¦²"], reply: "à¦­à¦¾à¦°à¦¤à§‡à¦° à¦œà¦¾à¦¤à§€à¦¯à¦¼ à¦«à§à¦² à¦¹à¦²à§‹ à¦ªà¦¦à§à¦®à¦«à§à¦² ğŸŒ¸" },
    { keywords: ["à¦œà¦¾à¦¤à§€à¦¯à¦¼ à¦ªà¦¾à¦–à¦¿"], reply: "à¦­à¦¾à¦°à¦¤à§‡à¦° à¦œà¦¾à¦¤à§€à¦¯à¦¼ à¦ªà¦¾à¦–à¦¿ à¦¹à¦²à§‹ à¦®à¦¯à¦¼à§‚à¦° ğŸ¦š" },
    { keywords: ["à¦°à¦¾à¦œà¦§à¦¾à¦¨à§€ à¦•à§‹à¦¥à¦¾à¦¯à¦¼"], reply: "à¦ªà¦¶à§à¦šà¦¿à¦®à¦¬à¦™à§à¦—à§‡à¦° à¦°à¦¾à¦œà¦§à¦¾à¦¨à§€ à¦¹à¦²à§‹ à¦•à¦²à¦•à¦¾à¦¤à¦¾ ğŸ™ï¸" },
    { keywords: ["à¦­à¦¾à¦°à¦¤ à¦•à¦¤ à¦¸à¦¾à¦²à§‡ à¦¸à§à¦¬à¦¾à¦§à§€à¦¨ à¦¹à¦¯à¦¼"], reply: "à§§à§¯à§ªà§­ à¦¸à¦¾à¦²à§‡à¦° à§§à§« à¦†à¦—à¦¸à§à¦Ÿ ğŸ‡®ğŸ‡³" },

    { keywords: ["à¦¸à§‚à¦°à§à¦¯ à¦•à¦¿ à¦—à§à¦°à¦¹", "sun planet"], reply: "à¦¨à¦¾, à¦¸à§‚à¦°à§à¦¯ à¦à¦•à¦Ÿà¦¿ à¦¤à¦¾à¦°à¦¾ (Star) ğŸ”†" },
    { keywords: ["à¦°à¦•à§à¦¤ à¦²à¦¾à¦² à¦•à§‡à¦¨"], reply: "à¦°à¦•à§à¦¤à§‡ à¦¹à¦¿à¦®à§‹à¦—à§à¦²à§‹à¦¬à¦¿à¦¨ à¦¥à¦¾à¦•à¦¾à¦° à¦•à¦¾à¦°à¦£à§‡ à¦à¦Ÿà¦¿ à¦²à¦¾à¦² à¦¦à§‡à¦–à¦¾à§Ÿ â¤ï¸" },
    { keywords: ["à¦ªà¦¾à¦¨à¦¿à¦° à¦¸à¦‚à¦•à§‡à¦¤"], reply: "à¦ªà¦¾à¦¨à¦¿à¦° à¦°à¦¾à¦¸à¦¾à¦¯à¦¼à¦¨à¦¿à¦• à¦¸à¦‚à¦•à§‡à¦¤ à¦¹à¦²à§‹ Hâ‚‚O ğŸ’§" },
    { keywords: ["à¦†à¦²à§‹à¦° à¦—à¦¤à¦¿"], reply: "à¦†à¦²à§‹à¦° à¦—à¦¤à¦¿ à¦ªà§à¦°à¦¾à§Ÿ à§©,à§¦à§¦,à§¦à§¦à§¦ à¦•à¦¿à¦®à¦¿/à¦¸à§‡à¦•à§‡à¦¨à§à¦¡ âš¡" },

    { keywords: ["(a+b)^2"], reply: "(a + b)Â² = aÂ² + 2ab + bÂ²" },
    { keywords: ["(a-b)^2"], reply: "(a - b)Â² = aÂ² - 2ab + bÂ²" },
    { keywords: ["(a+b)(a-b)"], reply: "(a + b)(a - b) = aÂ² - bÂ²" },
    { keywords: ["à¦—à¦¤à¦¿ ="], reply: "à¦—à¦¤à¦¿ = à¦¦à§‚à¦°à¦¤à§à¦¬ Ã· à¦¸à¦®à¦¯à¦¼" },
    { keywords: ["à¦¤à§à¦°à¦¿à¦­à§à¦œà§‡à¦° à¦•à§à¦·à§‡à¦¤à§à¦°à¦«à¦²"], reply: "Â½ Ã— base Ã— height" },
    { keywords: ["à¦¬à§ƒà¦¤à§à¦¤à§‡à¦° à¦•à§à¦·à§‡à¦¤à§à¦°à¦«à¦²"], reply: "Ï€ Ã— rÂ²" },

    { keywords: ["à¦†à¦ªà§‡à¦²", "apple"], reply: "à¦†à¦ªà§‡à¦²à§‡ à¦®à§à¦¯à¦¾à¦²à¦¿à¦• à¦…à§à¦¯à¦¾à¦¸à¦¿à¦¡ à¦¥à¦¾à¦•à§‡ ğŸ" },
    { keywords: ["à¦²à§‡à¦¬à§", "lemon"], reply: "à¦²à§‡à¦¬à§à¦¤à§‡ à¦¸à¦¿à¦Ÿà§à¦°à¦¿à¦• à¦…à§à¦¯à¦¾à¦¸à¦¿à¦¡ à¦¥à¦¾à¦•à§‡ ğŸ‹" },
    { keywords: ["à¦•à¦®à¦²à¦¾à¦²à§‡à¦¬à§", "orange"], reply: "à¦•à¦®à¦²à¦¾à¦²à§‡à¦¬à§à¦¤à§‡ à¦¸à¦¿à¦Ÿà§à¦°à¦¿à¦• à¦…à§à¦¯à¦¾à¦¸à¦¿à¦¡ à¦¥à¦¾à¦•à§‡ ğŸŠ" },

    { keywords: ["à¦¸à§à¦•à§à¦² à¦•à§‡à¦¨ à¦¯à¦¾à¦‡", "school"], reply: "à¦œà§à¦à¦¾à¦¨ à¦…à¦°à§à¦œà¦¨ à¦“ à¦¶à¦¿à¦•à§à¦·à¦¾à¦° à¦œà¦¨à§à¦¯ à¦¸à§à¦•à§à¦²à§‡ à¦¯à¦¾à¦‡ ğŸ«" },
    { keywords: ["à¦¶à¦¿à¦•à§à¦·à¦• à¦¦à¦¿à¦¬à¦¸"], reply: "à¦¶à¦¿à¦•à§à¦·à¦• à¦¦à¦¿à¦¬à¦¸ à§«à¦‡ à¦¸à§‡à¦ªà§à¦Ÿà§‡à¦®à§à¦¬à¦° ğŸ“…" },

    { keywords: ["à¦¬à¦¿à¦¦à§à¦¯à¦¾à¦¸à¦¾à¦—à¦°"], reply: "à¦ˆà¦¶à§à¦¬à¦°à¦šà¦¨à§à¦¦à§à¦° à¦¬à¦¿à¦¦à§à¦¯à¦¾à¦¸à¦¾à¦—à¦° à¦›à¦¿à¦²à§‡à¦¨ à¦¸à¦®à¦¾à¦œ à¦¸à¦‚à¦¸à§à¦•à¦¾à¦°à¦• ğŸ“š" },
    { keywords: ["à¦¨à§‡à¦¤à¦¾à¦œà¦¿"], reply: "à¦¨à§‡à¦¤à¦¾à¦œà¦¿ à¦¸à§à¦­à¦¾à¦·à¦šà¦¨à§à¦¦à§à¦° à¦¬à¦¸à§ à¦›à¦¿à¦²à§‡à¦¨ à¦à¦•à¦œà¦¨ à¦®à¦¹à¦¾à¦¨ à¦¸à§à¦¬à¦¾à¦§à§€à¦¨à¦¤à¦¾ à¦¸à¦‚à¦—à§à¦°à¦¾à¦®à§€ ğŸ‡®ğŸ‡³" },
    { keywords: ["à¦°à¦¬à§€à¦¨à§à¦¦à§à¦°à¦¨à¦¾à¦¥"], reply: "à¦°à¦¬à§€à¦¨à§à¦¦à§à¦°à¦¨à¦¾à¦¥ à¦ à¦¾à¦•à§à¦° à¦›à¦¿à¦²à§‡à¦¨ à¦•à¦¬à¦¿à¦—à§à¦°à§, à¦²à§‡à¦–à¦• à¦“ à¦¨à§‹à¦¬à§‡à¦²à¦œà¦¯à¦¼à§€ ğŸµ" },

    { keywords: ["à¦¤à§à¦®à¦¿ à¦•à¦¿ à¦®à¦¾à¦¨à§à¦·", "à¦¤à§à¦®à¦¿ à¦®à¦¾à¦¨à§à¦·"], reply: "à¦¨à¦¾, à¦†à¦®à¦¿ à¦à¦•à¦Ÿà¦¾ à¦•à¦®à§à¦ªà¦¿à¦‰à¦Ÿà¦¾à¦° à¦ªà§à¦°à§‹à¦—à§à¦°à¦¾à¦® ğŸ¤–" },
    { keywords: ["à¦¤à§à¦®à¦¿ à¦•à¦¿ à¦•à¦°à§‹"], reply: "à¦†à¦®à¦¿ à¦¤à§‹à¦®à¦¾à¦° à¦ªà§à¦°à¦¶à§à¦¨à§‡à¦° à¦‰à¦¤à§à¦¤à¦° à¦¦à¦¿à¦¤à§‡ à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à¦¿ ğŸ˜Š" },
    { keywords: ["à¦¤à§à¦®à¦¿ à¦˜à§à¦®à¦¾à¦“"], reply: "à¦¨à¦¾, à¦†à¦®à¦¿ à¦•à¦–à¦¨à§‹ à¦˜à§à¦®à¦¾à¦‡ à¦¨à¦¾ ğŸ˜„" },

    { keywords: ["à¦ªà§à¦²à§‡à¦¨ à¦¦à§à¦°à§à¦˜à¦Ÿà¦¨à¦¾", "plane crash"], reply: "à¦¸à¦®à§à¦ªà§à¦°à¦¤à¦¿ à¦†à¦¹à¦®à§‡à¦¦à¦¾à¦¬à¦¾à¦¦à§‡ à¦à¦•à¦Ÿà¦¿ à¦ªà§à¦²à§‡à¦¨ à¦¦à§à¦°à§à¦˜à¦Ÿà¦¨à¦¾ à¦˜à¦Ÿà§‡à¦›à§‡ âœˆï¸" },
  ];

  // à¦…à¦‚à¦• à¦•à§à¦¯à¦¾à¦²à¦•à§à¦²à§‡à¦¶à¦¨
  if (/^[0-9+\-*/xXÃ·(). ]+$/.test(userInput)) {
    try {
      let expression = userInput.replace(/x|X/gi, "*").replace(/Ã·/g, "/");
      setTimeout(() => {
        try {
          let result = eval(expression);
          botReply("à¦‰à¦¤à§à¦¤à¦° à¦¹à¦²à§‹: " + result);
        } catch {
          botReply("à¦…à¦™à§à¦• à¦¬à§à¦à¦¤à§‡ à¦ªà¦¾à¦°à¦¿à¦¨à¦¿, à¦†à¦¬à¦¾à¦° à¦²à¦¿à¦–à§‹ ğŸ”¢");
        }
      }, 1200); // à¦Ÿà¦¾à¦‡à¦ªà¦¿à¦‚ à¦à¦«à§‡à¦•à§à¦Ÿà§‡à¦° à¦œà¦¨à§à¦¯ 1.2 à¦¸à§‡à¦•à§‡à¦¨à§à¦¡ à¦¦à§‡à¦°à¦¿
      return;
    } catch {
      botReply("à¦…à¦™à§à¦• à¦¬à§à¦à¦¤à§‡ à¦ªà¦¾à¦°à¦¿à¦¨à¦¿, à¦†à¦¬à¦¾à¦° à¦²à¦¿à¦–à§‹ ğŸ”¢");
      return;
    }
  }

  // à¦®à¦¿à¦² à¦–à§à¦à¦œà§‡ à¦¬à§‡à¦° à¦•à¦°à¦¾ (à¦•à¦¿à¦›à§à¦Ÿà¦¾ fuzzy matching)
  function findReply() {
    for (let item of replies) {
      for (let key of item.keywords) {
        // à¦¯à¦¦à¦¿ à¦ªà§à¦°à§‹ key à¦Ÿà¦¾ userInput-à¦ à¦¥à¦¾à¦•à§‡, à¦¤à¦–à¦¨ return à¦•à¦°à§‹
        if (userInput.includes(key)) {
          return item.reply;
        }
        // à¦¯à¦¦à¦¿ à¦¨à¦¾ à¦¥à¦¾à¦•à§‡, à¦¤à¦¾à¦¹à¦²à§‡ similarity à¦¦à§‡à¦–à§‡ à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à§‹
        if (similarity(userInput, key) > 0.7) {
          return item.reply;
        }
      }
    }
    return null;
  }

  const matchedReply = findReply();

  if (matchedReply) {
    // à¦Ÿà¦¾à¦‡à¦ªà¦¿à¦‚ à¦à¦«à§‡à¦•à§à¦Ÿà§‡à¦° à¦®à¦¤à§‹ 1.5 à¦¸à§‡à¦•à§‡à¦¨à§à¦¡ à¦ªà¦°à§‡ à¦°à¦¿à¦ªà§à¦²à¦¾à¦‡ à¦¦à¦¾à¦“
    setTimeout(() => {
      botReply(matchedReply);
    }, 1500);
  } else {
    setTimeout(() => {
      botReply("Ayan à¦†à¦®à¦¾à§Ÿ à¦à¦Ÿà¦¾ à¦¶à§‡à¦–à¦¾à§Ÿà¦¨à¦¿, à¦†à¦®à¦¿ à¦ªà¦°à§‡ à¦¬à¦²à¦¬ ğŸ™");
    }, 1500);
  }
}
